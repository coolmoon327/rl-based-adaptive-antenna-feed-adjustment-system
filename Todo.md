# 天馈

> - 查找天线覆盖计算公式
>
> - 为论文准备：
>   1. 天馈是什么
>   2. 天馈面临哪些问题
>   3. 我们的问题关注的是天馈的哪一方面、解决的是什么问题
>   4. 该问题的传统解决方案有哪些？
>   5. 5G新应用下该问题有什么改变之处？
>   6. 引入我们提出的改进方法
>
>   > - RSSI（Received Signal StrengthIndicator接收信号强度指示)：UE探测带宽内一个OFDM符号所有RE上的总接收功率（若是20M的系统带宽，当没有下行数据时，则为200个导频RE上接收功率总和，当有下行数据时，则为1200个RE上接收功率总和），包括服务小区和非服务小区信号、相邻信道干扰，系统内部热噪声等。即为总功率S+I+N，其中I为干扰功率，N为噪声功率。反映当前信道的接收信号强度和干扰程度。
>   >    rssi在无线网络中表示信号的强度,它随距离的增大而衰减,通常为负值,该值越接近零说明信号强度越高。
>   >    RSSI持续过低，说明基站收到的上行信号太弱，可能导致解调失败。 RSSI持续过高，说明收到的上行信号太强，相互之间的干扰太大，也影响信号解调。
>   > - RSRQ（Reference Signal Receiving Quality）表示LTE参考信号接收质量，这种度量主要是根据信号质量来对不同LTE候选小区进行排序。这种测量用作切换和小区重选决定的输入。
>   >    RSRQ被定义为N*RSRP/(LTE载波RSSI）之比，其中N是LTE载波RSSI测量带宽的资源块（RB）个数。RSRQ实现了一种有效的方式报告信号强度和干扰相结合的效果。反映和指示当前信道质量的信噪比和干扰水平。为了使测量得到的RSRQ为负值，与RSRP保持一致，因此RSRP定义的是单个RE上的信号功率，RSSI定义的是一个OFDM符号上所有RE的总接收功率。
>   >    *取值范围：-3~-19.5 ，值越大越好
>   > - RSRP(Reference Signal Receiving Power，参考信号接收功率) 是LTE网络中可以代表无线信号强度的关键参数以及物理层测量需求之一，是在某个符号内承载参考信号的所有RE(资源粒子)上接收到的信号功率的平均值。通俗得理解，RSRP的功率值代表了每个子载波的功率值
>   >    用处和规范都等同于WCDMA中的RSCP（Received Signal Code Power）接收信号码功率。
>   >   - 取值范围：-44~-140dBm,值越大越好
>   >   - 衡量标准![img](https:////upload-images.jianshu.io/upload_images/4123353-555ad352ca9f6410.png?imageMogr2/auto-orient/strip|imageView2/2/w/784/format/webp)
>
> - 需要注意的是，4G多基站打到一块地方就会出现干扰，因为基站采用的是固定宽波束持续发送，干扰的表现是覆盖重叠区域的RSRP明显下降；而5G SSB波束采用多维窄波束时分扫描发送，考虑到64天线基站最大支持8个SSB窄波束扫描，在仿真里就让5G基站覆盖重叠区域以1/8的概率降低RSRP值，该干扰暂且认为是每多一个基站覆盖，就降低一个RSRP数量级（<u>存疑，建议问问电信的人</u>）
>
> - 4G有机械下倾角（手调）、电下倾角（电控）、预制下倾角（不可调），5G有机械下倾角、电下倾角、预制下倾角和数字下倾角（调整基带数字权值带来的倾角，粒度可达1度），本论文考虑5G基站的俯仰角调整训练，因此默认采用电+数字的调整模式，认为调整粒度为1度，调整范围[0, 总下倾]，总下倾角度的计算方法见论文《5G天馈系统下倾角设置原则研究》，论文里近似到45度（<u>存疑，建议问问电信的人</u>）
>
> - 之后问问5G的波束1/2半功率角，然后根据上面论文的式子计算覆盖区域，在覆盖区域内就在覆盖良好的RSSI值中随机取一个数，该数减掉来自干扰的影响作为一个均值，然后以该均值作方差为某数（调参）的高斯采样，采到的数值就是该点的RSSI值；在覆盖区域之外的，统统在最差的RSRP范围内随机高斯取值
>
> - 水平角度比较好解决，带反射板的两个半波振子的角度是90度，不知道实际天线是多少，如果查不到就用90度来仿真
>
> - 衰减采用瑞利模型（模拟城市环境）或莱斯衰落模型（模拟开阔环境），在前面的下倾角问题上进一步加上对衰减的考虑，需要计算一下天线到地面的斜边距离，在上述取出来的随机结果上面再进一步加上衰落的影响

# RL

> - 在单站上验证几个传统的算法：
>
>   PPO
>
>   Q-Learning -> DQN（融合众多优化方法-Rainbow）
>
>   A2C：Pathwise derivative policy gradient （https://blog.csdn.net/acl_lihan/article/details/104087569/）->DDPG->D4PG
>
> - 试着建模成CMDP问题：
>
>   约束：？
>
> - 电信覆盖地图的一个区域有多个基站，试着以区域为单位，进行A3C等多Actor算法的实现
>
> - 最后应该会以天面为单位部署强化学习算法，并且不再使用整个片区的RSRP作为Observation，而是单独为每个天面切片出“潜在覆盖区域”
>
> - 一个解决状态统一性的思路：1. 每个天面的调整改为垂直与水平分离 2. 垂直状态使用沿半径方向的平均值队列（每一个平均值obs_vertical[i]是该半径r[i]上潜在覆盖范围内所有RSRP的加权平均，i以n米为单位），并根据基站高度进行归一化调整，拉大后，空余的点用线性拟合的方式估出结果 3. 水平状态同理，只不过队列变成了沿着环状方向的平均值（每一个平均值obs_horizontal[i]是该弧度a[i]上潜在覆盖范围内所有RSRP的加权平均，i以n度为单位），并归一化到360度
>
> - 上述思路必然会导致部分点的RSRP被忽略，解决方法就是减小n的取值，但减小取值后状态又会与距离基站较近的区域高度相关，所以n的取值需要在实践中斟酌
>
> - 纳什均衡实际上在很多决策中都作为的是一个次优目标，很多地方达到纳什均衡就可以了。在我们的模型中，A3C能够在一定程度上降低迭代到纳什均衡点的几率，因为A3C的训练会弱化特例，也就是每个actor实际上不是在执行他的环境下的最优解，这种方法效果好不好还需要测试，但肯定没那么容易变成纳什均衡
>
> - reward的选取可以尝试几种方法找最优，比如计算潜在覆盖区域内的RSRP平均值、按照-2、-1、0、1、2来估值每个点后的平均估价、优秀覆盖点出现的次数等。哪怕reward用全局来算，也不一定能减轻纳什均衡的问题，因为在本模型下纳什均衡主要受actor观测的状态影响，使用全局reward/把优化目标改成了全局的或许在一定程度上有效（可以试试，但我总觉得不行，因为这样会稀释掉reward和observation的关联性），但是，全局reward会导致收敛变差、干扰情况变多，只有全局状态+全局reward才是理想规避纳什均衡的方法，但很明显这种调度是更加不可行的，环境与单一天馈的相关性差将导致根本无法收敛的结果
>
> - obs_horizontal在进行归一化时，可以不用考虑拉伸补点，而是直接从现有的角度里，抽样出m个角度，效果和拿近值补m个点一样。obs_vertical必须先算出最远距离，虽然可以调整到90度，但考虑到瑞丽衰落等，最好计算一个调整的角度上限，该上限的中心辐射区域RSRP低于-115（因此，在仿真模型里，低于-115的基站不予考虑）
>
> - A3C与纳什均衡：https://zhuanlan.zhihu.com/p/106222962
>
> - 其实基于上面的思路，也可以直接进行二维图的归一化：对每个基站的潜在覆盖区域，因为都是发散的扇形，所以可以以角度为x轴、以半径为y轴对扇形区域内的点进行采样。存在一些问题：
>
>   1. 采样时，同一个点可能会被多次采样，尤其是靠近基站侧的——可以认为是把扇形拉成了矩形，并拿就近的值来填充拉大的空白区域，但会导致近侧点的权重过大，不过在实际应用中，基站确实应该更加关注临近侧的覆盖情况，并且后续使用cnn来提取特征值时可以通过训练来弱化这部分的特征权重。
>   2. 基站高度不统一，需要一个基准的扇形——暂定以30m的基站为标准，最远区域取该基站瑞利衰落后RSRP高于-115的地方（r_m），最近就是基站所处的点（r_l=0）。对该基准按照地图上每个格子的尺寸cellSize进行划分，获得y轴的大小(r_m - r_l) / cellSize。
>   3. x轴采样——x轴是角度层面的采样，可以观测基准的y轴空间有多大，然后x轴取和y轴一样的空间尺寸，也就是将角度划分成y轴尺寸那么多次，最后获得一个正方形空间。
>   4. 如何处理非标准扇形——实际情况下，潜在覆盖范围可能是一个同心圆的一部分，也可能是一个残缺的扇形，这时候我们就需要先对扇形缺损的区域进行补全，具体的方法其实就可以用之前设计的近邻+线性预测法。至于这类扇形的上下界，其实下界拓展至r_l=0最好，上界理论上说应该拓展到RSRP刚好高于-115的地方，但会导致大量失真（在实际应用中不用担心这点，因为不会存在大面积的残缺，只有仿真中会），在仿真中可以考虑把仿真区域外围的一圈点进行随机化处理（也会降低仿真精度）。
>   5. 综上，我们的仿真会导致处于边缘的基站产生一些麻烦的问题，其结果就是相关天面的收敛性变差，我们可以考虑手动剔除A3C中这类天面训练数据的影响。
>   补充：其实y轴也可以简化归一化过程，就直接从天面开始，以一定角度为单位，对俯仰角进行采样，每个俯仰角射到地面的点作为RSRP的采样半径。另外，当前天面的俯仰角和归一化方位角也需要作为observation
>   
> - MADDPG的Critic使用的是所有agents的obs，在我们的环境下，其实可以进行优化，直接传入整张地图的obs即可（先用普通MADDPG测试，测试后进行优化，论文中就说基于基础MADDPG的改进）
>
> - 或许要加一点探索策略进去？maze的环境下，发现maddpg探索性蛮差的。
>



# 仿真

> - 地图设置为正方形，随机布置多个基站，每个基站有三个天线板
> - 单基站的行为其实就是调整天线板的俯仰角、方位角，每个天线板在一个角度范围内调整（方位角：0-120、120-240、240-360，俯仰角：0-90）
> - 状态为当前地图的整个覆盖效果（需要用CNN对当前覆盖情况进行评估），以及本基站三根天线的角度——也就是说可以将基站之间的互相关抽象到地图的覆盖效果上，我们只需要关注地图的覆盖和本基站的天线角度即可
> - 假定单站高度均为30m，用**天馈**里说的方法来算RSRP
> - 一个比较麻烦的问题就是怎么评判地图的覆盖情况，可以训练一个对全局状态好坏的判断，也可以单纯把状态用cnn读进去然后作为输入，评判好坏在ppt里讨论了几种方案，我觉得全部可以试一试

